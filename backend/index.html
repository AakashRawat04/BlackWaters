<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket System Monitoring</title>
    <style>
        pre { font-size: 1rem; white-space: pre-wrap; }
        .container { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Real-Time System Monitoring</h1>

    <div class="container">
        <h2>System Information</h2>
        <pre id="system-info">Connecting to system info server...</pre>
    </div>

    <div class="container">
        <h2>Training Information</h2>
        <pre id="training-info">Connecting to training info server...</pre>
    </div>

    <script>
        // Connect to the system monitoring WebSocket
        const systemSocket = new WebSocket("ws://0.0.0.0:3000/ws");

        systemSocket.onopen = function(event) {
            document.getElementById("system-info").textContent = "Connected to system info. Receiving data...";
        };

        systemSocket.onmessage = function(event) {
            const systemData = JSON.parse(event.data);
            console.log(systemData);
            document.getElementById("system-info").textContent = formatSystemData(systemData);
        };

        systemSocket.onclose = function(event) {
            document.getElementById("system-info").textContent = "Connection to system info closed.";
        };

        systemSocket.onerror = function(event) {
            document.getElementById("system-info").textContent = "Error occurred in system info connection.";
        };

        // Connect to the training WebSocket
        const trainingSocket = new WebSocket("ws://0.0.0.0:3000/ws2");

        trainingSocket.onopen = function(event) {
            document.getElementById("training-info").textContent = "Connected to training info. Receiving data...";
        };

        trainingSocket.onmessage = function(event) {
            const trainingData = JSON.parse(event.data);
            document.getElementById("training-info").textContent = formatTrainingData(trainingData);
        };

        trainingSocket.onclose = function(event) {
            document.getElementById("training-info").textContent = "Connection to training info closed.";
        };

        trainingSocket.onerror = function(event) {
            document.getElementById("training-info").textContent = "Error occurred in training info connection.";
        };

        function formatSystemData(data) {
            let output = "CPU Information:\n";
            output += `Processor: ${data.cpu_info.Processor}\n`;
            output += `Cores: ${data.cpu_info.Cores}\n`;
            output += `Threads: ${data.cpu_info.Threads}\n`;
            output += `CPU Usage (%): ${data.cpu_info["CPU Usage (%)"]}\n\n`;

            output += "Memory Information:\n";
            output += `Total Memory (GB): ${data.memory_info["Total Memory (GB)"]}\n`;
            output += `Used Memory (GB): ${data.memory_info["Used Memory (GB)"]}\n`;
            output += `Memory Usage (%): ${data.memory_info["Memory Usage (%)"]}\n\n`;

            output += "Disk Information:\n";
            data.disk_info.forEach(disk => {
                output += `Device: ${disk.Device}, Mount Point: ${disk["Mount Point"]}, `;
                output += `File System: ${disk["File System"]}, Total Size (GB): ${disk["Total Size (GB)"]}, `;
                output += `Used (GB): ${disk["Used (GB)"]}, Free (GB): ${disk["Free (GB)"]}, Usage (%): ${disk["Usage (%)"]}\n`;
            });

            if (data.gpu_info !== "No GPU detected") {
                output += "\nGPU Information:\n";
                data.gpu_info.forEach(gpu => {
                    output += `GPU Name: ${gpu["GPU Name"]}, GPU Load (%): ${gpu["GPU Load (%)"]}, `;
                    output += `Memory Free (MB): ${gpu["Memory Free (MB)"]}, Memory Used (MB): ${gpu["Memory Used (MB)"]}, `;
                    output += `Memory Total (MB): ${gpu["Memory Total (MB)"]}, Temperature (C): ${gpu["Temperature (C)"]}\n`;
                });
            } else {
                output += "\nNo GPU detected.\n";
            }

            return output;
        }

        // Function to format the training data into readable text
        function formatTrainingData(data) {
            console.log(data);
            let output = `Epoch: ${data.Epoch}\n`;
            output += `Batch: ${data.Batch}\n`;
            output += `Loss: ${data.Loss}\n`;
            output += `Accuracy: ${data.Accuracy}\n`;
            return output;
        }
    </script>
</body>
</html>
